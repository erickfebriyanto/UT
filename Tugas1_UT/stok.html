<!DOCTYPE html>
<html lang="id">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Stok Bahan Ajar</title>
	<!-- Bootstrap + helper CSS -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
	<link rel="stylesheet" href="css/styles.css">
</head>
<body>
	<!-- Navbar dimuat dari partial -->
	<div id="navbar"></div>

	<!-- Tabel stok terisi dari dataBahanAjar + form untuk tambah baris -->
	<div class="container my-4">
		<div class="d-flex align-items-center justify-content-between mb-3">
			<h1 class="h4 m-0">Stok Bahan Ajar</h1>
		</div>

		<!-- Tabel stok -->
		<div class="card mb-4">
			<div class="card-body">
				<div class="table-responsive">
					<table class="table table-sm table-striped align-middle">
						<thead class="table-light">
							<tr>
								<th scope="col">Kode Lokasi</th>
								<th scope="col">Kode Barang</th>
								<th scope="col">Nama Barang</th>
								<th scope="col">Jenis</th>
								<th scope="col">Edisi</th>
								<th scope="col" class="text-end">Stok</th>
								<th scope="col">Cover</th>
							</tr>
						</thead>
						<tbody id="tbodyStok"></tbody>
					</table>
				</div>
			</div>
		</div>

		<!-- Form tambah baris -->
		<div class="card">
			<div class="card-body">
				<h2 class="h6 mb-3">Tambah Stok Baru</h2>
				<form id="formTambah" class="row g-3">
					<div class="col-12 col-md-3">
						<label class="form-label" for="inLokasi">Kode Lokasi</label>
						<input id="inLokasi" class="form-control" placeholder="cth: 0JKT01" required>
					</div>
					<div class="col-12 col-md-3">
						<label class="form-label" for="inKode">Kode Barang</label>
						<input id="inKode" class="form-control" placeholder="cth: EKMA4216" required>
					</div>
					<div class="col-12 col-md-6">
						<label class="form-label" for="inNama">Nama Barang</label>
						<input id="inNama" class="form-control" placeholder="cth: Manajemen Keuangan" required>
					</div>
					<div class="col-12 col-md-3">
						<label class="form-label" for="inJenis">Jenis</label>
						<select id="inJenis" class="form-select" required>
							<option value="" selected disabled>Pilih jenis</option>
							<option value="BMP">BMP</option>
							<option value="Non-BMP">Non-BMP</option>
						</select>
					</div>
					<div class="col-6 col-md-2">
						<label class="form-label" for="inEdisi">Edisi</label>
						<input id="inEdisi" type="number" min="1" class="form-control" placeholder="cth: 1" required>
					</div>
					<div class="col-6 col-md-2">
						<label class="form-label" for="inStok">Stok</label>
						<input id="inStok" type="number" min="0" class="form-control" placeholder="cth: 100" required>
					</div>
					<div class="col-12 col-md-5">
						<label class="form-label" for="inCover">URL Cover (opsional)</label>
						<input id="inCover" class="form-control" placeholder="cth: img/cover.jpg">
					</div>
					<div class="col-12 col-md-12 d-flex justify-content-end">
						<button type="submit" class="btn btn-primary">Tambah</button>
					</div>
				</form>
			</div>
		</div>

	</div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	<script src="js/data.js"></script>
	<script>
		// filepath: c:\xampp\htdocs\Tugas1_UT\stok.html (script)
		// Proteksi halaman
		const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
		if (!currentUser) window.location.href = 'index.html';

		// Navbar + set nama user
		fetch('partials/navbar.html').then(r => r.text()).then(html => {
			document.getElementById('navbar').innerHTML = html;
			const el = document.getElementById('userName');
			if (el) el.textContent = currentUser.nama;
		});

		// Logout global
		function logout() { sessionStorage.removeItem('currentUser'); window.location.href = 'index.html'; }
		window.logout = logout;

		// Buat baris tabel dari 1 item stok (menggunakan helper cover-44 untuk gambar)
		function buatBaris(x) {
			const tr = document.createElement('tr');
			tr.innerHTML = `
				<td>${x.kodeLokasi || '-'}</td>
				<td>${x.kodeBarang || '-'}</td>
				<td>${x.namaBarang || '-'}</td>
				<td>${x.jenisBarang || '-'}</td>
				<td>${x.edisi ?? '-'}</td>
				<td class="text-end">${x.stok ?? '-'}</td>
				<td>${x.cover ? `<img src="${x.cover}" alt="cover" class="cover-44 rounded" onerror="this.src='https://via.placeholder.com/44x44?text=%20'">` : '-'}</td>
			`;
			return tr;
		}

		// Render semua data stok ke tabel
		function renderTabel() {
			const tbody = document.getElementById('tbodyStok');
			tbody.innerHTML = '';
			(dataBahanAjar || []).forEach(x => tbody.appendChild(buatBaris(x)));
		}
		renderTabel();

		// Tambah baris stok baru ke dataBahanAjar dan langsung append ke tabel
		document.getElementById('formTambah').addEventListener('submit', e => {
			e.preventDefault();
			const item = {
				kodeLokasi: inLokasi.value.trim(),
				kodeBarang: inKode.value.trim(),
				namaBarang: inNama.value.trim(),
				jenisBarang: inJenis.value,
				edisi: Number(inEdisi.value),
				stok: Number(inStok.value),
				cover: inCover.value.trim()
			};
			if (!item.kodeLokasi || !item.kodeBarang || !item.namaBarang || !item.jenisBarang) return;
			if (isNaN(item.edisi) || isNaN(item.stok)) return;
			dataBahanAjar.push(item);
			document.getElementById('tbodyStok').appendChild(buatBaris(item));
			e.target.reset(); inJenis.value = '';
		});
	</script>
</body>
</html>
