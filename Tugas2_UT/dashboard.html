<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Sistem Bahan Ajar</title>
    
    <!-- Bootstrap CSS untuk komponen UI -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <!-- CSS kustom (helper class) -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Placeholder untuk navbar yang akan diinject via JavaScript -->
    <div id="navbar"></div>

    <!-- Container utama dengan margin vertikal -->
    <div class="container my-3">
        <!-- Card untuk menampilkan greeting dan waktu -->
        <div class="card">
            <div class="card-body">
                <!-- Greeting: teks sambutan sesuai waktu (pagi/siang/sore/malam) -->
                <h1 class="h3 mb-2" id="greeting"></h1>
                <!-- Datetime: tanggal dan jam lengkap dalam format Indonesia -->
                <div class="text-muted" id="datetime"></div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS: untuk komponen interaktif (dropdown navbar) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ===== PROTEKSI HALAMAN =====
        // Ambil data user dari sessionStorage
        // JSON.parse: konversi string JSON kembali ke objek
        const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
        
        // Jika tidak ada data user (belum login), redirect ke halaman login
        if (!currentUser) window.location.href = 'index.html';

        // ===== LOAD NAVBAR DINAMIS =====
        // fetch: ambil konten HTML dari file navbar
        fetch('partials/navbar.html')
            .then(r => r.text())  // konversi response ke teks
            .then(html => {
                // Inject HTML navbar ke dalam div#navbar
                document.getElementById('navbar').innerHTML = html;
                
                // Update nama user di navbar setelah navbar dimuat
                const el = document.getElementById('userName');
                if (el) el.textContent = currentUser.nama;
            });

        // ===== FUNGSI UPDATE UI (GREETING & DATETIME) =====
        function updateUI() {
            // Ambil waktu saat ini
            const now = new Date();
            const h = now.getHours();  // jam (0-23)
            
            // Tentukan greeting berdasarkan jam
            // h < 5: dini hari (00:00-04:59) → Selamat Malam
            // h < 11: pagi (05:00-10:59) → Selamat Pagi
            // h < 15: siang (11:00-14:59) → Selamat Siang
            // h < 18: sore (15:00-17:59) → Selamat Sore
            // else: malam (18:00-23:59) → Selamat Malam
            const greet = h < 5 ? 'Selamat Malam' : 
                          h < 11 ? 'Selamat Pagi' : 
                          h < 15 ? 'Selamat Siang' : 
                          h < 18 ? 'Selamat Sore' : 'Selamat Malam';
            
            // Update elemen greeting dengan nama user
            document.getElementById('greeting').textContent = `${greet}, ${currentUser.nama}!`;
            
            // Format tanggal/waktu dalam bahasa Indonesia
            // dateStyle: 'full' → Senin, 1 Januari 2025
            // timeStyle: 'short' → 08:30
            document.getElementById('datetime').textContent = 
                now.toLocaleString('id-ID', { dateStyle: 'full', timeStyle: 'short' });
        }

        // ===== FUNGSI LOGOUT =====
        // Fungsi ini dipanggil dari tombol Logout di navbar
        function logout() {
            // Hapus data sesi dari sessionStorage
            sessionStorage.removeItem('currentUser');
            // Redirect ke halaman login
            window.location.href = 'index.html';
        }
        // Buat fungsi logout dapat diakses dari navbar (global scope)
        window.logout = logout;

        // ===== INISIALISASI =====
        // Panggil updateUI pertama kali saat halaman dimuat
        updateUI();
        
        // Set interval: panggil updateUI setiap 60 detik (60000 ms)
        // Ini memastikan greeting dan waktu selalu update otomatis
        setInterval(updateUI, 60000);
    </script>
</body>
</html>